<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Dashboard</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
      html{
        background: #EDEDED;
      }

      .card_holder{
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }

      .card{
        margin: 20px;
        background: white;
        overflow: hidden;
        width: 400px;
        height: 300px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      }

      .card-w2 {
        width: 600px;
      }

      .card-h2 {
        height: 300px;
      }

      .card iframe{
        border: none;
        margin: none;
        padding: none;
        stroke: none;
        width: 100%;
        height: 100%;
      }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

    <script>
    var timeEnd = Math.floor(new Date().getTime());
    var timeStart = timeEnd - 60 * 60 * 24 * 7 * 4 * 1000;


       var query = {
		  "query": {
		    "filtered": {
		      "filter": {
		        "bool": {
		          "must": [
		            {
		              "range": {
		                "Time": {
		                  "gte": timeStart,
		                  "lte": timeEnd
		                }
		              }
		            }
		          ]
		        }
		      }
		    }
		  },
		  "size": 0,
		  "aggs": {
		  	"1": {
		      "date_histogram": {
		        "field": "Time",
		        "interval": "12h",
		        "pre_zone": "+02:00",
		        "pre_zone_adjust_large_interval": true,
		        "min_doc_count": 0,
		        "extended_bounds": {
		          "min": timeStart,
		          "max": timeEnd
		        }
		      },
		      "aggs": {
		        "1": {
		          "percentiles": {
		            "field": "score",
		            "percents": [
		              1,
		              5,
		              25,
		              50,
		              75,
		              95,
		              99
		            ]
		          }
		        }
		      }
		    },
		    "2": {
		      "date_histogram": {
		        "field": "Time",
		        "interval": "6h",
		        "pre_zone": "+02:00",
		        "pre_zone_adjust_large_interval": true,
		        "min_doc_count": 0,
		        "extended_bounds": {
		          "min": timeStart,
		          "max": timeEnd
		        }
		      },
		      "aggs": {
		        "1": {
		          "percentiles": {
		            "field": "score",
		            "percents": [
		              1,
		              5,
		              25,
		              50,
		              75,
		              95,
		              99
		            ]
		          }
		        }
		      }
		    }
		  }
		};

		var renderGraph = function (response) {
			var data = response.aggregations['2'].buckets;
			var barWidth = 500 / data.length;

			var y = d3.scale.linear()
    			.range([200, 0]);

    		var color = d3.scale.linear()
    			.domain([100, 0])
    			.range(["rgb(100, 50, 50)", "rgb(200, 100, 100)"]);

			var chart = d3.select("#chart1");

			var bar = chart
			    .selectAll("div")
			    .data(data)
			  	.enter().append("div").attr('class', 'bar')
			  	.style('width', barWidth + 'px')
			    //.style("height", function(d) { return d.doc_count * 10 + "px"; })
			    //.text(function(d) { return d.doc_count; });

			 bar.selectAll('div')
			 .data(function(d, i){ 
			 	var arr = [];
			 	d = d['1'].values;
			 	for(key in d)
			 		arr.push({key: key, value: d[key]});
			 	return arr;
			 })
			 .enter().append("div")
			 .style('height', function(d) { return (d.value * 0.3) + "px"; })
			 .style('background', function(d) { return color(parseFloat(d.key)) })
			 .attr('class', 'bar-part')
			 //.text(function(d) { return d.key; });
		}

		$(function(){
			$.post('http://elastic.pliq.se/speed-laget-pages-v1/_search', JSON.stringify(query), renderGraph);
		})
    </script>

    <style>
#chart1{
	margin: 20px;
}

    .bar{
    	display: inline-block;
    	background: cornflowerblue;

    }
    </style>
</head>
<body>
    <div class="card_holder">
    <div class="card card-w2">
		<div id="chart1"></div>
    </div>


   <!--    <div class="card">
        <iframe src="http://kibana.pliq.se/#/visualize/create?embed&type=pie&indexPattern=speed-laget-assets-v1&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:size),schema:metric,type:sum),(id:'2',params:(field:parent,order:desc,orderBy:'1',size:5),schema:segment,type:terms)),listeners:(),params:(addLegend:!t,addTooltip:!t,isDonut:!t,shareYAxis:!t),type:pie))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Startsite-score-perc.?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:score,percents:!(1,5,25,50,75,95,99)),schema:metric,type:percentiles),(id:'2',params:(extended_bounds:(),field:Time,interval:hour,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!t,addTooltip:!t,defaultYExtents:!f,mode:stacked,shareYAxis:!t),type:area))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Assets-by-type?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:size),schema:metric,type:avg),(id:'2',params:(extended_bounds:(),field:Time,interval:hour,min_doc_count:1),schema:segment,type:date_histogram),(id:'3',params:(field:type,order:desc,orderBy:'1',size:5),schema:group,type:terms)),listeners:(),params:(addLegend:!t,addTooltip:!t,defaultYExtents:!f,mode:stacked,shareYAxis:!t),type:area))" ></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Top-10-Worst-start-pages?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-4h,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:score),schema:metric,type:min),(id:'2',params:(field:url,order:asc,orderBy:'1',size:5),schema:segment,type:terms)),listeners:(),params:(addLegend:!f,addTooltip:!t,defaultYExtents:!f,mode:stacked,shareYAxis:!t),type:histogram))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Top-worst-pages-by-number-of-requests?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-4h,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:yslowrequestsv),schema:metric,type:avg),(id:'2',params:(field:url,order:desc,orderBy:'1',size:6),schema:segment,type:terms)),listeners:(),params:(addLegend:!f,addTooltip:!t,defaultYExtents:!f,mode:stacked,shareYAxis:!t),type:histogram))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Startpage-avg.-page-size?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:yslowpageWeightv),schema:metric,type:avg),(id:'2',params:(extended_bounds:(),field:Time,interval:auto,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!f,addTooltip:!t,defaultYExtents:!f,shareYAxis:!t),type:line))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Startpage-avg.-requests-per-page?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:yslowrequestsv),schema:metric,type:avg),(id:'2',params:(extended_bounds:(),field:Time,interval:auto,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!f,addTooltip:!t,defaultYExtents:!f,shareYAxis:!t),type:line))"></iframe>
      </div>

      <div class="card card-w2 card-h2">
        <iframe src="http://kibana.pliq.se/#/visualize/edit/Laget-Startpage-perc.-requests?embed&_g=(refreshInterval:(display:Off,section:0,value:0),time:(from:now-7d,mode:quick,to:now))&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:'*')),vis:(aggs:!((id:'1',params:(field:score,percents:!(5,25,50,75,95)),schema:metric,type:percentiles),(id:'2',params:(extended_bounds:(),field:Time,interval:auto,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!f,addTooltip:!t,defaultYExtents:!f,shareYAxis:!t),type:line))"></iframe>
      </div> -->

    </div>
</body>
</html>
